import{w as I}from"./install.BDrB77ox.js";import{h as T,j as v,m as b,d as x,al as m,N as y,I as u,a4 as E,am as M,a as f,X as w,M as L}from"./framework.jepuxw6g.js";const N={data:{type:Array,required:!0},lineadle:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1}};function k(a,o=0,l=[]){return o++,a.reduce((r,t)=>{const n={...t};if(n.level=o,l.length>0&&l[l.length-1].level>=o)for(;l.length&&l[l.length-1].level>=o;)l.pop();l.push(n);const e=l[l.length-2];if(e&&(n.parentId=e.id),n.children){const d=k(n.children,o,l);return delete n.children,r.concat(n,d)}else return n.isLeaf=!0,r.concat(n)},[])}function _(a){const o=(n,e=!0)=>{const d=[],s=a.value.findIndex(c=>c.id===n.id);for(let c=s+1;c<a.value.length&&n.level<a.value[c].level;c++)(e||n.level===a.value[c].level-1)&&d.push(a.value[c]);return d},l=T(()=>{let n=[];const e=[];for(const d of a.value)n.includes(d)||(d.expanded!==!0&&(n=o(d)),e.push(d));return e});return{expandedTree:l,getChildren:o,getChildrenExpanded:n=>{const e=[],d=l.value.findIndex(s=>s.id===n.id);for(let s=d+1;s<l.value.length&&n.level<l.value[s].level;s++)e.push(l.value[s]);return e},getIndex:n=>n?a.value.findIndex(e=>e.id===n.id):-1}}function B(a){return{toggleNode:l=>{const r=a.value.find(t=>t.id===l.id);r&&(r.expanded=!r.expanded)}}}function O(a,{getChildren:o}){return{toggleCheckedNode:r=>{o(r).forEach(d=>{d.checked=r.checked});const t=a.value.find(d=>d.id===r.parentId);if(!t)return;const n=o(t,!1),e=n.filter(d=>d.checked);t.checked=e.length===n.length}}}function V(a,{getIndex:o,getChildren:l}){function r(){let e="";const d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let s=0;s<9;s++)e+=d.charAt(Math.floor(Math.random()*d.length));return e}return{append:(e,d)=>{const s=l(e,!1),c=s[s.length-1];let i=o(e)+1;c&&(i=o(c)+1),e.expanded=!0,e.isLeaf=!1;const p=v({...d,level:e.level+1,parentId:e.id,isLeaf:!0});p.value.id===void 0&&(p.value.id=r()),a.value.splice(i,0,p.value)},remove:e=>{const d=l(e).map(s=>s.id);a.value=a.value.filter(s=>s.id!==e.id&&!d.includes(s.id))}}}function j(a){const o=v(k(b(a))),l=_(o),t=[B,O,V].reduce((n,e)=>({...n,...e(o,l)}),{});return{innerData:o,...t,...l}}const P={...N,treeNode:{type:Object,required:!0},lineadle:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1}},g=24,h=24,R=x({name:"MTreeNode",props:P,setup(a,{slots:o}){const{checkable:l,operable:r,treeNode:t}=m(a),{append:n,remove:e,toggleNode:d,toggleCheckedNode:s,getChildrenExpanded:c}=y("TREE_UTILS"),i=v(!1),p=()=>{i.value=!i.value};return()=>u("div",{onMouseenter:p,onMouseleave:p,class:"m-tree--node",style:{paddingLeft:`${(t.value.level-1)*h}px`}},[!t.value.isLeaf&&t.value.expanded&&u("span",{class:"m-tree--node_vline",style:{height:`${c(t.value).length*g}px`,left:`${(t.value.level-1)*h+12}px`,top:`${g}px`}},null),t.value.isLeaf?u("span",{style:{display:"inline-block",width:"18px"}},null):o&&o.icon?o.icon({nodeData:t.value,toggleNode:d}):u("svg",{onClick:()=>{d(t.value)},style:{width:"18px",height:"18px",display:"inline-block",transform:t.value.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[u("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)]),l.value&&E(u("input",{type:"checkbox","onUpdate:modelValue":C=>t.value.checked=C,onChange:()=>s(t.value)},null),[[M,t.value.checked]]),o&&o.content?o.content({nodeData:t.value}):t.value.label,r.value&&i.value&&u("div",{class:"m-tree--node_operate"},[u("span",{class:"m-tree--node_operate--item",onClick:()=>{n(t.value,{label:"新增节点"})}},[f("+")]),u("span",{class:"m-tree--node_operate--item",onClick:()=>{e(t.value)}},[f("x")])])])}}),S=x({name:"MTree",props:N,setup(a,{slots:o}){const{data:l}=m(a),r=j(l);return w("TREE_UTILS",{append:r.append,remove:r.remove,toggleNode:r.toggleNode,toggleCheckedNode:r.toggleCheckedNode,getChildren:r.getChildren,getChildrenExpanded:r.getChildrenExpanded}),()=>u("div",{class:"m-tree"},[u("div",null,[r.expandedTree.value.map(t=>u(R,L(a,{treeNode:t}),{icon:o.icon,content:o.content}))])])}}),q=I(S);export{q as M};
